# ğŸš€ éƒ¨ç½²å®ŒæˆæŒ‡å—

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. ä¸­é—´ä»¶é…ç½®
- **æ–‡ä»¶**: `functions/_middleware.js`
- **ç­–ç•¥**: ç®€åŒ–ä¸ºæ”¾è¡Œæ‰€æœ‰è¯·æ±‚
- **åŸå› **: Pages çš„é™æ€ HTML æ–‡ä»¶ä¸ç»è¿‡ä¸­é—´ä»¶

### 2. å‰ç«¯ç™»å½•éªŒè¯
- **æ–‡ä»¶**: `js/auth.js`
- **ä¿æŠ¤çš„é¡µé¢**:
  - âœ… `indexNew.html` - åŠ©å­¦é‡‘ç”³è¯·ç³»ç»Ÿ(ä¸»é¡µ)
  - âœ… `index-chaxun.html` - ç»§ç»­æ•™è‚²æŠ¥åç³»ç»Ÿ
- **å…¬å¼€é¡µé¢**:
  - âœ… `login.html` - ç™»å½•é¡µé¢

### 3. ç™»å½•æµç¨‹

```
ç”¨æˆ·è®¿é—® â†’ å‰ç«¯æ£€æŸ¥ token â†’ æœªç™»å½• â†’ è·³è½¬ login.html
                              â†“
                          å·²ç™»å½• â†’ æ˜¾ç¤ºé¡µé¢
```

## ğŸ” å®‰å…¨æœºåˆ¶

### å‰ç«¯ä¿æŠ¤(å·²å®ç°)
```javascript
// js/auth.js è‡ªåŠ¨æ‰§è¡Œ
1. æ£€æŸ¥ localStorage.getItem('userToken')
2. å¦‚æœæ²¡æœ‰ token â†’ è·³è½¬åˆ° login.html
3. å¦‚æœæœ‰ token â†’ è§£æå¹¶æ˜¾ç¤ºç”¨æˆ·å
```

### åç«¯ä¿æŠ¤
```javascript
// functions/login.js
1. éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
2. ç”Ÿæˆ JWT token (24å°æ—¶æœ‰æ•ˆ)
3. è¿”å› token ç»™å‰ç«¯
```

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### æ–¹å¼ 1: Cloudflare Pages Dashboard

1. **æäº¤ä»£ç åˆ° Git**
   ```bash
   git add .
   git commit -m "é…ç½®å®Œæˆ,å‡†å¤‡éƒ¨ç½²"
   git push
   ```

2. **Cloudflare è‡ªåŠ¨éƒ¨ç½²**
   - Cloudflare æ£€æµ‹åˆ°æ¨é€
   - è‡ªåŠ¨å¼€å§‹æ„å»ºå’Œéƒ¨ç½²
   - 1-2 åˆ†é’Ÿåå®Œæˆ

3. **è®¾ç½®ç¯å¢ƒå˜é‡**
   - è¿›å…¥ Cloudflare Dashboard
   - **Workers & Pages** â†’ ä½ çš„é¡¹ç›®
   - **Settings** â†’ **Environment variables**
   - æ·»åŠ :
     * Name: `JWT_SECRET`
     * Value: ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ç”Ÿæˆ
       ```bash
       node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
       ```
     * Type: **Encrypt**
   - **Save** å¹¶ **Retry deployment**

### æ–¹å¼ 2: å‘½ä»¤è¡Œéƒ¨ç½²

```bash
# 1. éƒ¨ç½²åˆ° Cloudflare Pages
wrangler pages deploy . --project-name=liming

# 2. è®¾ç½® JWT_SECRET
wrangler pages secret put JWT_SECRET --project-name=liming

# è¾“å…¥ç”Ÿæˆçš„å¯†é’¥(32å­—èŠ‚éšæœºå­—ç¬¦ä¸²)
```

## ğŸ§ª æµ‹è¯•æ¸…å•

éƒ¨ç½²å®Œæˆå,æŒ‰é¡ºåºæµ‹è¯•:

### 1. æµ‹è¯•ç™»å½•é¡µé¢
- [ ] è®¿é—® `https://liming-aty.pages.dev/login.html`
- [ ] é¡µé¢æ­£å¸¸åŠ è½½,æ—  "Unauthorized" é”™è¯¯
- [ ] å¯ä»¥çœ‹åˆ°ç™»å½•è¡¨å•

### 2. æµ‹è¯•æœªç™»å½•è®¿é—®ä¿æŠ¤é¡µé¢
- [ ] è®¿é—® `https://liming-aty.pages.dev/indexNew.html`
- [ ] è‡ªåŠ¨è·³è½¬åˆ° `/login.html`
- [ ] è®¿é—® `https://liming-aty.pages.dev/index-chaxun.html`
- [ ] åŒæ ·è·³è½¬åˆ° `/login.html`

### 3. æµ‹è¯•ç™»å½•åŠŸèƒ½
- [ ] åœ¨ç™»å½•é¡µé¢è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
- [ ] ç‚¹å‡»ç™»å½•
- [ ] ç™»å½•æˆåŠŸåè·³è½¬åˆ° `indexNew.html`
- [ ] å¯ä»¥çœ‹åˆ° "æ¬¢è¿æ‚¨,XXX"

### 4. æµ‹è¯•ç™»å½•åè®¿é—®
- [ ] è®¿é—® `indexNew.html` - æ­£å¸¸æ˜¾ç¤º
- [ ] è®¿é—® `index-chaxun.html` - æ­£å¸¸æ˜¾ç¤º
- [ ] ç‚¹å‡» "é€€å‡ºç™»å½•" - æ¸…é™¤ token,è·³è½¬åˆ°ç™»å½•é¡µ

### 5. æµ‹è¯•é™æ€èµ„æº
- [ ] CSS æ ·å¼æ­£å¸¸åŠ è½½
- [ ] JavaScript æ­£å¸¸æ‰§è¡Œ
- [ ] å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- [ ] Logo æ­£ç¡®æ˜¾ç¤º

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: è®¿é—® login.html æ˜¾ç¤º "Unauthorized"
**è§£å†³**: âœ… å·²ä¿®å¤!`_middleware.js` å·²ç®€åŒ–,ä¸å†æ‹¦æˆªé™æ€æ–‡ä»¶

### é—®é¢˜ 2: ç™»å½•åæ˜¾ç¤º 500 é”™è¯¯
**åŸå› **: JWT_SECRET æœªè®¾ç½®
**è§£å†³**: åœ¨ Cloudflare Dashboard è®¾ç½®ç¯å¢ƒå˜é‡

### é—®é¢˜ 3: ç™»å½•æˆåŠŸä½†ç«‹å³è·³å›ç™»å½•é¡µ
**åŸå› **: token æœªæ­£ç¡®ä¿å­˜æˆ– auth.js éªŒè¯å¤±è´¥
**æ£€æŸ¥**: 
- F12 æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯
- æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ userToken
- æ£€æŸ¥ token æ ¼å¼æ˜¯å¦æ­£ç¡®(JWT ä¸‰æ®µå¼)

### é—®é¢˜ 4: é¡µé¢è·³è½¬ä¸æ­£ç¡®
**åŸå› **: è·¯å¾„é—®é¢˜
**æ£€æŸ¥**: æ‰€æœ‰æ–‡ä»¶å·²ä½¿ç”¨ç›¸å¯¹è·¯å¾„ âœ…

## ğŸ“Š æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
```
âœ… functions/
   â”œâ”€â”€ _middleware.js      # ç®€åŒ–çš„ä¸­é—´ä»¶(æ”¾è¡Œæ‰€æœ‰è¯·æ±‚)
   â””â”€â”€ login.js            # ç™»å½• API (JWT ç”Ÿæˆ)

âœ… js/
   â”œâ”€â”€ auth.js             # å‰ç«¯ç™»å½•éªŒè¯
   â””â”€â”€ login.js            # ç™»å½•è¡¨å•å¤„ç†

âœ… HTML é¡µé¢
   â”œâ”€â”€ login.html          # ç™»å½•é¡µ(å…¬å¼€)
   â”œâ”€â”€ indexNew.html       # ä¸»é¡µ(å—ä¿æŠ¤)
   â””â”€â”€ index-chaxun.html   # æŸ¥è¯¢ç³»ç»Ÿ(å—ä¿æŠ¤)

âœ… é…ç½®æ–‡ä»¶
   â”œâ”€â”€ _redirects          # é‡å®šå‘è§„åˆ™
   â””â”€â”€ wrangler.toml       # Cloudflare é…ç½®
```

## ğŸ‰ éƒ¨ç½²æˆåŠŸ!

å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡,æ­å–œ!ä½ çš„åº”ç”¨å·²ç»æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œåœ¨:

```
ğŸŒ https://liming-aty.pages.dev
```

### ç‰¹æ€§
- âš¡ å…¨çƒ CDN åŠ é€Ÿ
- ğŸ”’ è‡ªåŠ¨ HTTPS
- ğŸ›¡ï¸ DDoS é˜²æŠ¤
- ğŸ“Š å®æ—¶åˆ†æ
- ğŸ”„ Git è‡ªåŠ¨éƒ¨ç½²
- ğŸ” JWT è®¤è¯ä¿æŠ¤

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. âœ… é…ç½®è‡ªå®šä¹‰åŸŸå(å¯é€‰)
3. âœ… è®¾ç½® D1 æ•°æ®åº“(å¦‚éœ€è¦)
4. âœ… é…ç½®é‚®ä»¶é€šçŸ¥(å¯é€‰)
5. âœ… æ·»åŠ æ›´å¤šåŠŸèƒ½

---

**æœ‰é—®é¢˜éšæ—¶åé¦ˆ!** ğŸš€

